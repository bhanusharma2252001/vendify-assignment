generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id               String   @id @default(uuid()) // treated as tenant id
  name             String
  category_id      String
  registered_at    DateTime
  registeration_no String
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  category Category @relation(fields: [category_id], references: [id])
  address  Address?
  users    User[]

  @@map("companies")
}

model Category {
  id      String    @id @default(uuid())
  name    String
  company Company[]

  @@map("categories")
}

model Address {
  id            String  @id @default(uuid())
  address_line1 String
  address_line2 String
  zipCode       String
  city          String
  state         String
  country       String
  company       Company @relation(fields: [company_id], references: [id])
  company_id    String  @unique

  @@map("addresses")
}

model Role {
  id         String   @id @default(uuid())
  name       String   @unique // "CA", "STORE_MANAGER"
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  users             User[]
  @@map("roles")
}



model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  password_hash String
  is_deleted    Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  company_id    String
  role_id       String
  created_by_id String? // null only for initial CA account

  company       Company @relation(fields: [company_id], references: [id])
  role          Role    @relation(fields: [role_id], references: [id])
  created_by    User?   @relation("UserCreatedBy", fields: [created_by_id], references: [id])
  created_users User[]  @relation("UserCreatedBy")

  @@index([company_id])
  @@index([role_id])
  @@index([email])
  @@index([is_deleted])
  @@map("users")
}
